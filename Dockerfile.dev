# ============================================
# Development Dockerfile with hot reload
# ============================================
FROM node:22-alpine AS base

WORKDIR /app

# Install shared dependencies and build
COPY shared/package*.json ./shared/
RUN cd shared && npm ci

COPY shared/ ./shared/
RUN cd shared && npm run build

# ============================================
# Client development with Vite
# ============================================
FROM base AS client-dev

WORKDIR /app

# Install client dependencies
COPY client/package*.json ./client/
RUN cd client && npm ci

COPY client/ ./client/

EXPOSE 5173

WORKDIR /app/client
CMD ["npm", "run", "dev", "--", "--host", "0.0.0.0"]

# ============================================
# Server development with tsx watch
# ============================================
FROM base AS server-dev

WORKDIR /app

# Install server dependencies
COPY server/package*.json ./server/
RUN cd server && npm ci

COPY server/ ./server/

EXPOSE 3001

WORKDIR /app/server
CMD ["npm", "run", "dev"]
